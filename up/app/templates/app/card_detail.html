{% extends "./_base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div id="card-detail-container">
    <div class="card-detail-header">
        <a id="back-btn" href="{% url 'index' %}"><img id="card-detail-back-arrow-img"
                src="{% static '/images/icons/back-arrow.png' %}" alt="back-arrow"></a>
        <img id="card-detail-profile-img" src="{% static '/images/icons/person.svg' %}"
            class="rounded-circle account-img" alt="person-icon">
        <p id="card-detail-username">{{ item.created_by }}</p>
    </div>

    <div id="card-detail-img-container">
        {% if item.image %}
        <div>
            <img id="card-detail-img" src="{{ item.image.url }}">
        </div>
        {% else %}
        <div>
            <img src="{% static '/images/icons/gray.jpg' %}" style="width:100%;height:50vh">
        </div>
        {% endif %}
    </div>

    <div class="card-detail-footer">
        <a id="back-btn-on-card-detail-footer" href="{% url 'index' %}"><img id="card-detail-back-arrow-img"
                src="{% static '/images/icons/back-arrow.png' %}" alt="back-arrow"></a>
        <div id="user-info-on-card-detail">
            <img id="card-detail-profile-img" src="{% static '/images/icons/person.svg' %}"
                class="rounded-circle account-img" alt="person-icon">
            <p id="card-detail-username">{{ item.created_by }}</p>
        </div>
        <p id="restaurant-memo">{{ item.restaurant_memo|default_if_none:"未記入" }}</p>
    </div>

</div>

<div class="comment-section-for-horizontal-card-detail">

    <p style="text-align: center; font-size: 21px;">コメント</p>

    <!-- コメント投稿トリガーボタン -->
    <button id="comment-btn-for-horizontal-card-detail" data-toggle="modal"
        data-target="#comment-modal">コメントする...</button>

    {% for comment in comments %}
    <div class="date">{{ comment.commented_date }}</div>
    <strong>{{ comment.author }}</strong>
    <p>{{ comment.comment_text|linebreaks }}</p>
    {% empty %}
    <p style="text-align: center;"></p>
    {% endfor %}

</div>

<a href="{% url 'index' %}" class="btn btn-outline-secondary">コメントする...</a>

<!-- コメント投稿モーダル -->
{{ form.certifications.errors }}
<div class="modal" id="comment-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 100%; overflow-y: auto;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" id="comment-forms" enctype="multipart/form-data" action="">
                    {% csrf_token %}
                    <!-- テキストフィールド -->
                    {{ comment_form.comment_text|as_crispy_field }}
                    <input type="hidden" name="item_id" size="18" maxlength="20" value="{{item.id}}">

                    <div class="modal-footer">
                        <input type="submit" name="test1" value="送信する" class="submit-comment-btn">
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
{% endblock %}