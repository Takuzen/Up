{% extends "./_base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div id="card-detail-container">
    <div class="card-detail-header">
        <a id="back-btn" href="{% url 'index' %}"><img id="card-detail-back-arrow-img"
                src="{% static '/images/icons/back-arrow.png' %}" alt="back-arrow"></a>
        {% if item.created_by.image %}
        <img src="{{ item.created_by.image.url }}" id="card-detail-profile-img" class="rounded-circle account-img"
            alt="person-img">
        {% else %}
        <img src="{% static 'images/icons/person.svg' %}" id="card-detail-profile-img-default-v"
            class="rounded-circle account-img" alt="person-img">
        {% endif %}
        <p id="card-detail-username">{{ item.created_by }}</p>

        {% if show_follow_button %}
        <div>
            <form name="name_form" action="/ajax/" method="POST" id='ajax-follow-form'>
                <!-- <form name="name_form" action="/test_ajax_app/" method="POST"> -->
                {% csrf_token %}
                <input type="hidden" name="followee-name" value="{{ item.created_by }}">
                {% if is_following %}
                <input type="hidden" id="follow-boolean" name="is-follow" value="0">
                <input class="btn following-button" id="id-div-ajax-response" type="submit" value="フォロー中">
                {% else %}
                <input type="hidden" id="follow-boolean" name="is-follow" value="1">
                <input class="btn follow-button" id="id-div-ajax-response" type="submit" value="フォロー">
                {% endif %}
            </form>
        </div>
        {% endif %}
    </div>

    <div id="card-detail-img-container">
        {% if item.image %}
        <div>
            <img id="card-detail-img" src="{{ item.image.url }}">
        </div>
        {% else %}
        <div>
            <img src="{% static '/images/icons/gray.jpg' %}" style="width:100%;height:50vh">
        </div>
        {% endif %}
    </div>

    <div class="card-detail-footer">
        <a id="back-btn-on-card-detail-footer" href="{% url 'index' %}"><img id="card-detail-back-arrow-img"
                src="{% static '/images/icons/back-arrow.png' %}" alt="back-arrow"></a>
        <div id="user-info-on-card-detail">
            {% if item.created_by.image %}
            <img src="{{ item.created_by.image.url }}" id="card-detail-profile-img" class="rounded-circle account-img"
                alt="person-img">
            {% else %}
            <img src="{% static 'images/icons/person.svg' %}" id="card-detail-profile-img-default-h"
                class="rounded-circle account-img" alt="person-img">
            {% endif %}
            <p id="card-detail-username">{{ item.created_by }}</p>
            {% if show_follow_button %}
            <div>
                <form name="name_form" action="/ajax/" method="POST" id='ajax-follow-form-2'>
                    <!-- <form name="name_form" action="/test_ajax_app/" method="POST"> -->
                    {% csrf_token %}
                    <input type="hidden" name="followee-name" value="{{ item.created_by }}">
                    {% if is_following %}
                    <input type="hidden" id="follow-boolean-2" name="is-follow" value="0">
                    <input class="btn following-button" id="id-div-ajax-response-2" type="submit" value="フォロー中">
                    {% else %}
                    <input type="hidden" id="follow-boolean-2" name="is-follow" value="1">
                    <input class="btn follow-button" id="id-div-ajax-response-2" type="submit" value="フォロー">
                    {% endif %}
                </form>
            </div>
            {% endif %}
        </div>
        <p id="restaurant-memo">{{ item.restaurant_memo|default_if_none:"未記入" }}</p>

        <!-- コメント -->
        <div class="card-sized-comment-section">

            <div class="comments">
                <button id="comment-btn" data-toggle="modal" data-target="#comment-modal">コメントする...</button>
                {% for comment in comments %}
                <div class="comment-date">{{ comment.commented_date }}</div>
                <strong class="commenter-username">{{ comment.author }}</strong>
                <p class="comment-text">{{ comment.comment_text }}</p>
                {% empty %}
                {% endfor %}
            </div>

        </div>

    </div>

</div>

<div class="full-sized-comment-section">

    <!-- コメント投稿トリガーボタン -->
    <div id="full-sized-comment-btn-container">
        <button id="full-sized-comment-btn" data-toggle="modal" data-target="#comment-modal">コメントする...</button>
    </div>
    <div class="full-sized-comments">
        {% for comment in comments %}
        <div class="comment-date">{{ comment.commented_date }}</div>
        <strong class="commenter-username">{{ comment.author }}</strong>
        <p class="comment-text">{{ comment.comment_text }}</p>
        {% empty %}
        {% endfor %}
    </div>

</div>

<!-- コメント投稿モーダル -->
{{ form.certifications.errors }}
<div class="modal" id="comment-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 100%; overflow-y: auto;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" id="comment-forms" enctype="multipart/form-data" action="">
                    {% csrf_token %}
                    <!-- テキストフィールド -->
                    {{ comment_form.comment_text|as_crispy_field }}
                    <input type="hidden" name="item_id" size="18" maxlength="20" value="{{item.id}}">

                    <div class="modal-footer">
                        <input type="submit" name="test1" value="送信する" class="submit-comment-btn">
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

{% endblock %}